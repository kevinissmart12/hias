{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: 'addMap',\n  data() {\n    return {\n      //地图初始配置\n      center: '舟山市',\n      //13,16\n      zoom: 16,\n      marker: {},\n      position: {\n        lng: 0,\n        lat: 0\n      },\n      draggable: false,\n      //infowindow展示\n      show: false,\n      //需要绘制的图行\n      drawingPolygon: {\n        editing: false,\n        paths: []\n      },\n      drawingMarker: {},\n      //infowindow属性,\n      infoPosition: {},\n      infoOwner: '',\n      infoproduct: '',\n      //对地图上已存在的图形进行编辑的属性\n      id: '',\n      editPond: false\n    };\n  },\n  methods: {\n    // 初始化地图参数\n    handler({\n      BMap,\n      map\n    }) {\n      // console.log(BMap, map)\n      this.center = this.Center;\n      this.zoom = 16;\n      this.position.lng = 122.048;\n      this.position.lat = 29.9424;\n      this.draggable = true;\n    },\n    //获取池塘\n    getPonds() {\n      this.$axios({\n        url: '/api/ponds/getAll',\n        methods: 'GET'\n      }).then(res => {\n        if (res.data.status == 200) {\n          this.$store.commit('ponds/setPolygons', res.data.data.data);\n          this.getAllTown();\n          this.getALlVillage();\n        }\n      });\n    },\n    //跳转到水产\n    goProduct(id) {\n      this.$router.push({\n        path: `/products/add?id=${id}`\n      });\n    },\n    //计算中心点\n    getCenterPoint(path) {\n      //添加marker\n      //计算中心点\n      let lng = 0;\n      let lat = 0;\n      path.forEach((i, v) => {\n        lng = lng + i.lng;\n        lat = lat + i.lat;\n      });\n      lng = lng / path.length;\n      lat = lat / path.length;\n      let drawingObj = {\n        lng: lng,\n        lat: lat\n      };\n      return drawingObj;\n    },\n    //计算面积\n    getArea(path) {\n      let Arr = [];\n      //把path转化成需要的数组形式,path里现在是对象\n      path.forEach((i, v) => {\n        let arr = [];\n        arr.push(i.lng);\n        arr.push(i.lat);\n        Arr.push(arr);\n      });\n      Arr.push([path[0].lng, path[0].lat]);\n      var p = this.turf.polygon([Arr]);\n      // 平方米\n      var area = this.turf.area(p);\n      // 亩\n      var mu = area / (1000 * 2 / 3);\n      return mu;\n    },\n    infoWindowClose() {\n      this.show = false;\n      //全部设置为false\n      this.$store.commit('ponds/setEditingFalse');\n      this.$store.commit('ponds/setClickFn', false);\n\n      // if(!this.EditPond){\n      //     //设置当前查看的图形id\n      //     this.id=''\n      //     this.$store.commit('ponds/setId','')\n      // }\n    },\n\n    infoWindowOpen(item) {\n      this.$store.commit('ponds/setClickFn', true);\n      if (item.id == 65535) {\n        this.infoPosition = {\n          lng: item.position.lng,\n          lat: item.position.lat\n        };\n        let newItem = this.Polygons[this.Polygons.length - 1];\n        //新增的\n        this.infoOwner = {\n          id: newItem.owner.Id,\n          name: newItem.owner.name\n        };\n        this.infoproduct = {\n          id: newItem.product.id,\n          name: newItem.product.name\n        };\n        //设置form的一系列值，传到store\n        this.$store.commit('ponds/setNumber', newItem.number);\n        this.$store.commit('ponds/setOwner', newItem.owner.name);\n        this.$store.commit('ponds/setOwnerId', newItem.owner.id);\n        this.$store.commit('ponds/setProduct', newItem.product.name);\n        this.$store.commit('ponds/setProductId', newItem.product.id);\n        this.$store.commit('ponds/setLng', newItem.position.lng);\n        this.$store.commit('ponds/setLat', newItem.position.lat);\n        this.$store.commit('ponds/setEstimateArea', newItem.estimateArea);\n        this.$store.commit('ponds/setArea', newItem.area);\n        this.$store.commit('ponds/setCounty', newItem.county);\n        this.$store.commit('ponds/setTown', newItem.town);\n        this.$store.commit('ponds/setVillage', newItem.village);\n        this.$store.commit('ponds/setPolygon', newItem.polygon);\n        this.$store.commit('ponds/setComment', newItem.comment);\n        this.$store.commit('ponds/setCheckStatus', 0);\n        setTimeout(() => {\n          this.show = true;\n          //设置当前查看的图形id\n          this.id = newItem.id;\n          this.$store.commit('ponds/setId', newItem.id);\n        }, 100);\n      } else {\n        this.infoPosition = {\n          lng: item.position.lng,\n          lat: item.position.lat\n        };\n        this.infoOwner = item.owner;\n        this.infoproduct = item.product;\n\n        //设置form的一系列值，传到store\n        this.$store.commit('ponds/setNumber', item.number);\n        this.$store.commit('ponds/setOwner', item.owner.name);\n        this.$store.commit('ponds/setOwnerId', item.owner.id);\n        this.$store.commit('ponds/setProduct', item.product.name);\n        this.$store.commit('ponds/setProductId', item.product.id);\n        this.$store.commit('ponds/setLng', item.position.lng);\n        this.$store.commit('ponds/setLat', item.position.lat);\n        this.$store.commit('ponds/setEstimateArea', item.estimateArea);\n        this.$store.commit('ponds/setArea', item.area);\n        this.$store.commit('ponds/setCounty', item.county);\n        this.$store.commit('ponds/setTown', item.town);\n        this.$store.commit('ponds/setVillage', item.village);\n        this.$store.commit('ponds/setPolygon', item.polygon);\n        this.$store.commit('ponds/setComment', item.comment);\n        this.$store.commit('ponds/setCheckStatus', item.checkStatus);\n        setTimeout(() => {\n          this.show = true;\n          //设置当前查看的图形id\n          this.id = item.id;\n          this.$store.commit('ponds/setId', this.id);\n        }, 100);\n      }\n    },\n    //获取所有的镇和村\n    getAllTown() {\n      if (localStorage.getItem('town')) {\n        this.$store.commit('ponds/setTownData');\n      } else {\n        this.$axios({\n          url: '/api/area/getAllTown',\n          method: 'GET'\n        }).then(res => {\n          if (res.data.status == 200) {\n            //赋值  \n            this.$store.commit('ponds/setTownData', res.data.data.data);\n          }\n        });\n      }\n    },\n    getALlVillage() {\n      if (localStorage.getItem('village')) {\n        this.$store.commit('ponds/setVillageData');\n      } else {\n        this.$axios({\n          url: '/api/area/getAllVillage',\n          method: 'GET'\n        }).then(res => {\n          if (res.data.status == 200) {\n            //赋值  \n            this.$store.commit('ponds/setVillageData', res.data.data.data);\n          }\n        });\n      }\n      this.afterJump();\n    },\n    //从allponds页面跳到addponds页面要执行的函数\n    afterJump() {\n      setTimeout(() => {\n        if (this.$route.query) {\n          //如果是从查看过来的就需要获取polygons，然后循环查找\n          this.Polygons.forEach((i, v) => {\n            if (i.id == this.$route.query.id) {\n              this.infoWindowOpen(i);\n              return;\n            }\n          });\n        }\n      }, 300);\n    },\n    //多边形更新函数\n    polygonsUpdate(e) {\n      if (this.EditPond) {\n        let paths = e.target.getPath();\n        //中心点\n        let position = this.getCenterPoint(paths);\n        let estimateArea = this.getArea(paths);\n        //更改中心点位置更改面积\n        this.$store.commit('ponds/editPolygon', {\n          lng: position.lng,\n          lat: position.lat,\n          estimateArea: estimateArea,\n          paths: paths,\n          id: this.id\n        });\n        this.$store.commit('ponds/setDrawingPolygon', paths);\n      }\n    },\n    //以下为画图的三个函数\n    syncPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      if (!paths.length) {\n        return;\n      }\n      const path = paths[paths.length - 1];\n      if (!path.length) {\n        return;\n      }\n      if (path.length === 1) {\n        path.push(e.point);\n      }\n      this.$set(path, path.length - 1, e.point);\n    },\n    newPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      if (!paths.length) {\n        paths.push([]);\n      }\n      const path = paths[paths.length - 1];\n      path.pop();\n      if (path.length) {\n        paths.push([]);\n      }\n      //计算出中心点，面积\n      var position = this.getCenterPoint(paths[0]);\n      this.drawingMarker = position;\n      var estimateArea = this.getArea(paths[0]);\n      //点的路径\n      var polygon = paths[0];\n      //把这些值传到store，更新form值\n      //同时还要在polygons中查看是否已经新增了一个数组\n      //有了就更新值，不然就新增\n      this.$store.commit('ponds/setLng', position.lng);\n      this.$store.commit('ponds/setLat', position.lat);\n      this.$store.commit('ponds/setEstimateArea', estimateArea);\n      this.$store.commit('ponds/setPolygon', polygon);\n      this.$store.commit('ponds/setDrawingPolygon', polygon);\n      this.$store.commit('ponds/newPolygon', this.EditPond);\n      //把新增的多边形path清空\n      this.drawingPolygon.paths = [];\n      this.drawingMarker = {};\n      //停止绘制\n      this.$store.commit('ponds/setAddPond', false);\n    },\n    paintPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      !paths.length && paths.push([]);\n      paths[paths.length - 1].push(e.point);\n    }\n  },\n  computed: {\n    Polygons() {\n      return this.$store.state.ponds.polygons;\n    },\n    AddPond() {\n      return this.$store.state.ponds.addPond;\n    },\n    EditPond() {\n      return this.$store.state.ponds.editPond;\n    },\n    Center() {\n      return this.$store.state.ponds.center;\n    },\n    ClickFn() {\n      return this.$store.state.ponds.clickFn;\n    },\n    Id() {\n      return this.$store.state.ponds.id;\n    },\n    router() {\n      return this.$route.query;\n    }\n  },\n  watch: {\n    AddPond(n) {\n      this.drawingPolygon.editing = n;\n      if (n) {\n        this.show = false;\n        //如果当前有选中的id不为新增的池塘或者当前id不存在\n        //还要清空store中的form表\n        if (this.Id == '') {} else {\n          this.$store.commit('ponds/clearForm');\n        }\n      }\n    },\n    EditPond(n) {\n      this.editPond = n;\n      if (n) {\n        // console.log(n,'编辑模式');\n        this.show = false;\n        setTimeout(() => {\n          this.$store.commit('ponds/setEditing', {\n            id: this.id,\n            editing: true\n          });\n        }, 300);\n        this.$store.commit('ponds/ResetDrawingPolygon');\n      } else {\n        // console.log(n,'停止编辑模式');\n        //全部设置为false\n        this.$store.commit('ponds/setEditingFalse');\n      }\n    },\n    Center(n) {\n      this.center = n;\n    },\n    show(n) {\n      if (n) {\n        this.$store.commit('ponds/setClickFn', true);\n        this.$store.commit('ponds/ResetDrawingPolygon');\n      }\n    },\n    router(n) {\n      console.log(n);\n    }\n  },\n  created() {\n    this.getPonds();\n  },\n  destroyed() {\n    this.$store.commit('ponds/clearForm');\n    this.$store.commit('ponds/setCenter');\n    this.$store.commit('ponds/setCenter');\n    this.$store.commit('ponds/setCenter');\n  }\n};","map":{"version":3,"mappings":";AAoDA;EACAA;EACAC;IACA;MACA;MACAC;MACA;MACAC;MACAC;MACAC;QAAAC;QAAAC;MAAA;MACAC;MACA;MACAC;MACA;MACAC;QACAC;QACAC;MACA;MACAC;MACA;MACAC;MACAC;MACAC;MAEA;MACAC;MACAC;IAEA;EACA;EACAC;IACA;IACAC;MAAAC;MAAAC;IAAA;MACA;MACA;MACA;MAEA;MACA;MAEA;IAGA;IACA;IACAC;MACA;QACAC;QACAL;MACA;QACA;UACA;UACA;UACA;QAEA;MACA;IACA;IACA;IACAM;MACA;QACAC;MACA;IACA;IAEA;IACAC;MAEA;MACA;MACA;MACA;MAEAD;QACApB;QACAC;MACA;MAEAD;MACAC;MACA;QACAD;QACAC;MACA;MACA;IACA;IACA;IACAqB;MAEA;MACA;MACAF;QACA;QACAG;QACAA;QACAC;MACA;MACAA,UACAJ,aACAA,YACA;MAEA;MACA;MACA;MACA;MACA;MAEA;IACA;IAEAK;MACA;MACA;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;IAGA;;IACAC;MAEA;MAEA;QACA;UACA1B;UACAC;QACA;QACA;QACA;QACA;UACAU;UACAjB;QACA;QACA;UACAiB;UACAjB;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QAEAiC;UACA;UACA;UACA;UACA;QACA;MAEA;QACA;UACA3B;UACAC;QACA;QACA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QAGA0B;UACA;UACA;UACA;UACA;QACA;MACA;IAGA;IAEA;IACAC;MACA;QACA;MACA;QACA;UACAV;UACAW;QACA;UACA;YACA;YACA;UACA;QACA;MACA;IAEA;IACAC;MACA;QACA;MACA;QACA;UACAZ;UACAW;QACA;UACA;YACA;YACA;UAEA;QACA;MACA;MACA;IACA;IAGA;IACAE;MAEAJ;QACA;UACA;UACA;YACA;cACA;cAEA;YACA;UACA;QACA;MACA;IACA;IAIA;IACAK;MACA;QACA;QACA;QACA;QACA;QACA;QACA,wCACA;UAAAhC;UAAAC;UAAAgC;UAAA3B;UAAAK;QAAA;QACA;MACA;IAEA;IACA;IACAuB;MACA;QACA;MACA;MACA;QAAA5B;MAAA;MACA;QACA;MACA;MACA;MACA;QACA;MACA;MACA;QACAc;MACA;MACA;IACA;IACAe;MACA;QACA;MACA;MACA;QAAA7B;MAAA;MACA;QACAA;MACA;MACA;MACAc;MACA;QACAd;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IAEA;IACA8B;MACA;QACA;MACA;MACA;QAAA9B;MAAA;MACA;MACAA;IAEA;EACA;EACA+B;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;EAEA;EACAC;IACAN;MACA;MACA;QACA;QACA;QACA;QACA,oBAEA;UACA;QACA;MAGA;IACA;IACAC;MACA;MACA;QACA;QACA;QACAb;UACA;YAAAhB;YAAAN;UAAA;QACA;QACA;MAEA;QACA;QACA;QACA;MAEA;IACA;IACAoC;MACA;IACA;IACAtC;MACA;QACA;QACA;MACA;IACA;IACAyC;MACAE;IACA;EACA;EACAC;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;EAGA;AACA","names":["name","data","center","zoom","marker","position","lng","lat","draggable","show","drawingPolygon","editing","paths","drawingMarker","infoPosition","infoOwner","infoproduct","id","editPond","methods","handler","BMap","map","getPonds","url","goProduct","path","getCenterPoint","getArea","arr","Arr","infoWindowClose","infoWindowOpen","setTimeout","getAllTown","method","getALlVillage","afterJump","polygonsUpdate","estimateArea","syncPolygon","newPolygon","paintPolygon","computed","Polygons","AddPond","EditPond","Center","ClickFn","Id","router","watch","console","created","destroyed"],"sourceRoot":"src/components/ponds/AddPonds","sources":["AddMap_1.vue"],"sourcesContent":["<template>\r\n    <div class=\"addMap\">\r\n        <baidu-map  :scroll-wheel-zoom=\"true\" class=\"map\" :center=\"center\" :zoom=\"zoom\" @ready=\"handler\" map-type=\"BMAP_HYBRID_MAP\"\r\n            @mousemove=\"syncPolygon\" @click=\"paintPolygon\" @rightclick=\"newPolygon\"\r\n        >\r\n\r\n            <bm-scale anchor=\"BMAP_ANCHOR_TOP_RIGHT\"></bm-scale>\r\n            <bm-navigation anchor=\"BMAP_ANCHOR_TOP_RIGHT\"></bm-navigation>\r\n\r\n            <bm-marker \r\n                v-for=\"(item) in Polygons\"\r\n                :key=\"item.lat\"\r\n                :position=\"item.position\" \r\n                @click=\"infoWindowOpen(item)\"\r\n            >\r\n            </bm-marker>\r\n\r\n            <bm-info-window \r\n                :position=\"infoPosition\"\r\n                :show=\"show\" \r\n                @close=\"infoWindowClose\"\r\n            >\r\n                <div>当前池塘详细信息：</div>\r\n                <div>池塘负责人：{{infoOwner.name?infoOwner.name:'无'}}</div>\r\n                <div>养殖品种：\r\n                    <el-button v-if=\"infoproduct.name\" @click=\"goProduct(infoproduct.id)\" type=\"text\">{{infoproduct.name}}</el-button>\r\n                    <span v-else>无</span>\r\n                </div>\r\n                <el-button type=\"text\">查看该池塘详细信息</el-button>\r\n            </bm-info-window>\r\n\r\n            <bm-polygon \r\n                \r\n                v-for=\"(item,index) in Polygons\" \r\n                :key=\"index\" \r\n                :path=\"item.polygon\"\r\n                :editing=\"item.editing\"\r\n                @lineupdate='polygonsUpdate'\r\n            ></bm-polygon>\r\n            \r\n            <bm-marker v-if=\"drawingMarker\" :position='drawingMarker' ></bm-marker>\r\n            <bm-polygon \r\n                :path=\"path\" \r\n                v-for=\"path,index of drawingPolygon.paths\"\r\n                :key=\"index+10000\"\r\n            ></bm-polygon>\r\n\r\n        </baidu-map>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name:'addMap',\r\n    data(){\r\n        return{\r\n            //地图初始配置\r\n            center:'舟山市',\r\n            //13,16\r\n            zoom: 16,\r\n            marker:{},\r\n            position:{lng: 0, lat: 0},\r\n            draggable:false,\r\n            //infowindow展示\r\n            show:false,\r\n            //需要绘制的图行\r\n            drawingPolygon: {\r\n                editing: false,\r\n                paths: []\r\n            },\r\n            drawingMarker:{},\r\n            //infowindow属性,\r\n            infoPosition:{},\r\n            infoOwner:'',\r\n            infoproduct:'',\r\n\r\n            //对地图上已存在的图形进行编辑的属性\r\n            id:'',\r\n            editPond:false,\r\n\r\n        }\r\n    },\r\n    methods:{\r\n        // 初始化地图参数\r\n        handler ({BMap, map}) {\r\n            // console.log(BMap, map)\r\n            this.center=this.Center\r\n            this.zoom = 16\r\n\r\n            this.position.lng = 122.048\r\n            this.position.lat = 29.9424\r\n\r\n            this.draggable=true\r\n\r\n\r\n        },\r\n        //获取池塘\r\n        getPonds(){\r\n            this.$axios({\r\n                url:'/api/ponds/getAll',\r\n                methods:'GET'\r\n            }).then(res=>{\r\n                if(res.data.status==200){\r\n                    this.$store.commit('ponds/setPolygons',res.data.data.data)\r\n                    this.getAllTown()\r\n                    this.getALlVillage()\r\n\r\n                }\r\n            })\r\n        },\r\n        //跳转到水产\r\n        goProduct(id){\r\n            this.$router.push({\r\n                path:`/products/add?id=${id}`\r\n            })\r\n        },\r\n\r\n        //计算中心点\r\n        getCenterPoint(path){\r\n            \r\n            //添加marker\r\n            //计算中心点\r\n            let lng=0\r\n            let lat=0\r\n\r\n            path.forEach((i,v)=>{\r\n                lng=lng+i.lng\r\n                lat=lat+i.lat\r\n            })\r\n            \r\n            lng=lng/path.length\r\n            lat=lat/path.length\r\n            let drawingObj={\r\n                lng:lng,\r\n                lat:lat\r\n            }\r\n            return drawingObj\r\n        },\r\n        //计算面积\r\n        getArea(path){\r\n\r\n            let Arr=[]\r\n            //把path转化成需要的数组形式,path里现在是对象\r\n            path.forEach((i,v)=>{\r\n                let arr=[]\r\n                arr.push(i.lng)\r\n                arr.push(i.lat)\r\n                Arr.push(arr)\r\n            })\r\n            Arr.push([\r\n                path[0].lng,\r\n                path[0].lat\r\n            ])\r\n\r\n            var p=this.turf.polygon([Arr])\r\n            // 平方米\r\n            var area=this.turf.area(p)\r\n            // 亩\r\n            var mu=area/(1000*2/3)\r\n\r\n            return mu\r\n        },\r\n\r\n        infoWindowClose () {\r\n            this.show = false\r\n            //全部设置为false\r\n            this.$store.commit('ponds/setEditingFalse')\r\n            this.$store.commit('ponds/setClickFn',false)\r\n\r\n            // if(!this.EditPond){\r\n            //     //设置当前查看的图形id\r\n            //     this.id=''\r\n            //     this.$store.commit('ponds/setId','')\r\n            // }\r\n            \r\n\r\n        },\r\n        infoWindowOpen(item){\r\n\r\n            this.$store.commit('ponds/setClickFn',true)\r\n\r\n            if(item.id==65535){\r\n                this.infoPosition={\r\n                    lng:item.position.lng,\r\n                    lat:item.position.lat\r\n                }\r\n                let newItem=this.Polygons[this.Polygons.length-1]\r\n                //新增的\r\n                this.infoOwner={\r\n                    id:newItem.owner.Id,\r\n                    name:newItem.owner.name\r\n                }\r\n                this.infoproduct={\r\n                    id:newItem.product.id,\r\n                    name:newItem.product.name,\r\n                }\r\n                //设置form的一系列值，传到store\r\n                this.$store.commit('ponds/setNumber',newItem.number)\r\n                this.$store.commit('ponds/setOwner',newItem.owner.name)\r\n                this.$store.commit('ponds/setOwnerId',newItem.owner.id)\r\n                this.$store.commit('ponds/setProduct',newItem.product.name)\r\n                this.$store.commit('ponds/setProductId',newItem.product.id)\r\n                this.$store.commit('ponds/setLng',newItem.position.lng)\r\n                this.$store.commit('ponds/setLat',newItem.position.lat)\r\n                this.$store.commit('ponds/setEstimateArea',newItem.estimateArea)\r\n                this.$store.commit('ponds/setArea',newItem.area)\r\n                this.$store.commit('ponds/setCounty',newItem.county)\r\n                this.$store.commit('ponds/setTown',newItem.town)\r\n                this.$store.commit('ponds/setVillage',newItem.village)\r\n                this.$store.commit('ponds/setPolygon',newItem.polygon)\r\n                this.$store.commit('ponds/setComment',newItem.comment)\r\n                this.$store.commit('ponds/setCheckStatus',0)\r\n                \r\n                setTimeout(()=>{\r\n                    this.show = true\r\n                    //设置当前查看的图形id\r\n                    this.id=newItem.id\r\n                    this.$store.commit('ponds/setId',newItem.id)\r\n                },100)\r\n\r\n            }else{\r\n                this.infoPosition={\r\n                    lng:item.position.lng,\r\n                    lat:item.position.lat\r\n                }\r\n                this.infoOwner=item.owner\r\n                this.infoproduct=item.product\r\n                \r\n                //设置form的一系列值，传到store\r\n                this.$store.commit('ponds/setNumber',item.number)\r\n                this.$store.commit('ponds/setOwner',item.owner.name)\r\n                this.$store.commit('ponds/setOwnerId',item.owner.id)\r\n                this.$store.commit('ponds/setProduct',item.product.name)\r\n                this.$store.commit('ponds/setProductId',item.product.id)\r\n                this.$store.commit('ponds/setLng',item.position.lng)\r\n                this.$store.commit('ponds/setLat',item.position.lat)\r\n                this.$store.commit('ponds/setEstimateArea',item.estimateArea)\r\n                this.$store.commit('ponds/setArea',item.area)\r\n                this.$store.commit('ponds/setCounty',item.county)\r\n                this.$store.commit('ponds/setTown',item.town)\r\n                this.$store.commit('ponds/setVillage',item.village)\r\n                this.$store.commit('ponds/setPolygon',item.polygon)\r\n                this.$store.commit('ponds/setComment',item.comment)\r\n                this.$store.commit('ponds/setCheckStatus',item.checkStatus)\r\n                \r\n\r\n                setTimeout(()=>{\r\n                    this.show = true\r\n                    //设置当前查看的图形id\r\n                    this.id=item.id\r\n                    this.$store.commit('ponds/setId',this.id)\r\n                },100)\r\n            }\r\n\r\n\r\n        },\r\n\r\n        //获取所有的镇和村\r\n        getAllTown(){\r\n            if(localStorage.getItem('town')){\r\n                this.$store.commit('ponds/setTownData')\r\n            }else{\r\n                this.$axios({\r\n                    url:'/api/area/getAllTown',\r\n                    method:'GET',\r\n                }).then(res=>{\r\n                    if(res.data.status==200){\r\n                        //赋值  \r\n                        this.$store.commit('ponds/setTownData',res.data.data.data)\r\n                    }\r\n                })\r\n            }\r\n            \r\n        },\r\n        getALlVillage(){\r\n            if(localStorage.getItem('village')){\r\n                this.$store.commit('ponds/setVillageData')\r\n            }else{\r\n                this.$axios({\r\n                    url:'/api/area/getAllVillage',\r\n                    method:'GET',\r\n                }).then(res=>{\r\n                    if(res.data.status==200){\r\n                        //赋值  \r\n                        this.$store.commit('ponds/setVillageData',res.data.data.data)\r\n                        \r\n                    }\r\n                })\r\n            }\r\n            this.afterJump()\r\n        },\r\n\r\n\r\n        //从allponds页面跳到addponds页面要执行的函数\r\n        afterJump(){\r\n            \r\n            setTimeout(()=>{\r\n                if(this.$route.query){\r\n                    //如果是从查看过来的就需要获取polygons，然后循环查找\r\n                    this.Polygons.forEach((i,v)=>{\r\n                        if(i.id==this.$route.query.id){\r\n                            this.infoWindowOpen(i)\r\n                            \r\n                            return \r\n                        }\r\n                    })\r\n                }\r\n            },300)\r\n        },\r\n\r\n\r\n\r\n        //多边形更新函数\r\n        polygonsUpdate(e){\r\n            if(this.EditPond){\r\n                let paths=e.target.getPath()\r\n                //中心点\r\n                let position=this.getCenterPoint(paths)\r\n                let estimateArea=this.getArea(paths)\r\n                //更改中心点位置更改面积\r\n                this.$store.commit('ponds/editPolygon',\r\n                {lng:position.lng,lat:position.lat,estimateArea:estimateArea,paths:paths,id:this.id})\r\n                this.$store.commit('ponds/setDrawingPolygon',paths)\r\n            }\r\n            \r\n        },\r\n        //以下为画图的三个函数\r\n        syncPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            if (!paths.length) {\r\n                return\r\n            }\r\n            const path = paths[paths.length - 1]\r\n            if (!path.length) {\r\n                return\r\n            }\r\n            if (path.length === 1) {\r\n                path.push(e.point)\r\n            }\r\n            this.$set(path, path.length - 1, e.point)\r\n        },\r\n        newPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            if(!paths.length) {\r\n                paths.push([])\r\n            }\r\n            const path = paths[paths.length - 1]\r\n            path.pop()\r\n            if (path.length) {\r\n                paths.push([])\r\n            }\r\n            //计算出中心点，面积\r\n            var position=this.getCenterPoint(paths[0])\r\n            this.drawingMarker=position\r\n            var estimateArea=this.getArea(paths[0])\r\n            //点的路径\r\n            var polygon=paths[0]\r\n            //把这些值传到store，更新form值\r\n            //同时还要在polygons中查看是否已经新增了一个数组\r\n            //有了就更新值，不然就新增\r\n            this.$store.commit('ponds/setLng',position.lng)\r\n            this.$store.commit('ponds/setLat',position.lat)\r\n            this.$store.commit('ponds/setEstimateArea',estimateArea)\r\n            this.$store.commit('ponds/setPolygon',polygon)\r\n            this.$store.commit('ponds/setDrawingPolygon',polygon)\r\n            this.$store.commit('ponds/newPolygon',this.EditPond)\r\n            //把新增的多边形path清空\r\n            this.drawingPolygon.paths=[]\r\n            this.drawingMarker={}\r\n            //停止绘制\r\n            this.$store.commit('ponds/setAddPond',false)\r\n            \r\n        },\r\n        paintPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            !paths.length && paths.push([])\r\n            paths[paths.length - 1].push(e.point)\r\n            \r\n        }\r\n    },\r\n    computed:{\r\n        Polygons(){\r\n            return this.$store.state.ponds.polygons\r\n        },\r\n        AddPond(){\r\n            return this.$store.state.ponds.addPond\r\n        },\r\n        EditPond(){\r\n            return this.$store.state.ponds.editPond\r\n        },\r\n        Center(){\r\n            return this.$store.state.ponds.center\r\n        },\r\n        ClickFn(){\r\n            return this.$store.state.ponds.clickFn\r\n        },\r\n        Id(){\r\n            return this.$store.state.ponds.id\r\n        },\r\n        router(){\r\n            return this.$route.query\r\n        },\r\n\r\n    },\r\n    watch:{\r\n        AddPond(n){\r\n            this.drawingPolygon.editing=n\r\n            if(n){\r\n                this.show=false\r\n                //如果当前有选中的id不为新增的池塘或者当前id不存在\r\n                //还要清空store中的form表\r\n                if(this.Id==''){\r\n\r\n                }else{\r\n                    this.$store.commit('ponds/clearForm')\r\n                }\r\n                \r\n                \r\n            }\r\n        },\r\n        EditPond(n){\r\n            this.editPond=n\r\n            if(n){\r\n                // console.log(n,'编辑模式');\r\n                this.show=false\r\n                setTimeout(()=>{\r\n                    this.$store.commit('ponds/setEditing',{id:this.id,editing:true})\r\n                },300)\r\n                this.$store.commit('ponds/ResetDrawingPolygon')\r\n                \r\n            }else{\r\n                // console.log(n,'停止编辑模式');\r\n                //全部设置为false\r\n                this.$store.commit('ponds/setEditingFalse')\r\n                \r\n            }\r\n        },\r\n        Center(n){\r\n            this.center=n\r\n        },\r\n        show(n){\r\n            if(n){\r\n                this.$store.commit('ponds/setClickFn',true)\r\n                this.$store.commit('ponds/ResetDrawingPolygon')\r\n            }\r\n        },\r\n        router(n){\r\n            console.log(n);\r\n        }\r\n    },\r\n    created(){\r\n        this.getPonds()\r\n    },\r\n    destroyed(){\r\n        this.$store.commit('ponds/clearForm')\r\n        this.$store.commit('ponds/setCenter')\r\n        this.$store.commit('ponds/setCenter')\r\n        this.$store.commit('ponds/setCenter')\r\n\r\n\r\n    },\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n    .addMap{\r\n        width: 100%;\r\n        height: 100%;\r\n        .map{\r\n            width: 100%;\r\n            height: 100%;\r\n        }\r\n    }\r\n\r\n    .infoNone{\r\n        display: none;\r\n        opacity: 0;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}