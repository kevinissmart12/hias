{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: 'addMap',\n  data() {\n    return {\n      //地图初始配置\n      center: {\n        lng: 0,\n        lat: 0\n      },\n      zoom: 3,\n      marker: {},\n      position: {\n        lng: 0,\n        lat: 0\n      },\n      draggable: false,\n      //infowindow展示\n      show: false\n    };\n  },\n  methods: {\n    // 初始化地图参数\n    handler({\n      BMap,\n      map\n    }) {\n      // console.log(BMap, map)\n      this.center.lng = 122.048;\n      this.center.lat = 29.9424;\n      this.zoom = 16;\n      this.position.lng = 122.048;\n      this.position.lat = 29.9424;\n      this.draggable = true;\n    },\n    //获取池塘\n    getPonds() {\n      this.$axios({\n        url: '/api/ponds/getAll',\n        methods: 'GET'\n      }).then(res => {\n        console.log(res.data.data);\n        if (res.data.status == 200) {\n          this.$store.commit('ponds/setPolygons', res.data.data.data);\n        }\n      });\n    },\n    //跳转到水产\n    goProduct(id) {\n      this.$router.push({\n        path: `/products/add?id=${id}`\n      });\n    },\n    paintPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      !paths.length && paths.push([]);\n      paths[paths.length - 1].push(e.point);\n    },\n    syncPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      if (!paths.length) {\n        return;\n      }\n      const path = paths[paths.length - 1];\n      if (!path.length) {\n        return;\n      }\n      if (path.length === 1) {\n        path.push(e.point);\n      }\n      this.$set(path, path.length - 1, e.point);\n    },\n    newPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      if (!paths.length) {\n        paths.push([]);\n      }\n      const path = paths[paths.length - 1];\n      path.pop();\n      if (path.length) {\n        paths.push([]);\n      }\n      this.getCenterPoint();\n      this.getArea();\n    }\n  },\n  computed: {\n    Polygons() {\n      return this.$store.state.ponds.polygons;\n    },\n    AddPond() {\n      return this.$store.state.ponds.addPond;\n    },\n    EditPond() {\n      return this.$store.state.ponds.editPond;\n    }\n  },\n  created() {\n    this.getPonds();\n  }\n};","map":{"version":3,"mappings":";AAuDA;EACAA;EACAC;IACA;MACA;MACAC;QAAAC;QAAAC;MAAA;MACAC;MACAC;MACAC;QAAAJ;QAAAC;MAAA;MACAI;MACA;MACAC;IACA;EACA;EACAC;IACA;IACAC;MAAAC;MAAAC;IAAA;MACA;MACA;MACA;MACA;MAEA;MACA;MAEA;IAEA;IACA;IACAC;MACA;QACAC;QACAL;MACA;QACAM;QACA;UACA;QACA;MACA;IACA;IACA;IACAC;MACA;QACAC;MACA;IACA;IAEAC;MACA;QACA;MACA;MACA;QAAAC;MAAA;MAEA;MAEAA;IAGA;IACAC;MACA;QACA;MACA;MACA;QAAAD;MAAA;MACA;QACA;MACA;MACA;MACA;QACA;MACA;MACA;QACAF;MACA;MACA;IACA;IACAI;MACA;QACA;MACA;MACA;QAAAF;MAAA;MACA;QACAA;MACA;MACA;MACAF;MACA;QACAE;MACA;MACA;MACA;IACA;EACA;EACAG;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;EACA;EACAC;IACA;EACA;AACA","names":["name","data","center","lng","lat","zoom","marker","position","draggable","show","methods","handler","BMap","map","getPonds","url","console","goProduct","path","paintPolygon","paths","syncPolygon","newPolygon","computed","Polygons","AddPond","EditPond","created"],"sourceRoot":"src/components/ponds/AddPonds","sources":["AddMap_1.vue"],"sourcesContent":["<template>\r\n    <div class=\"addMap\">\r\n        <baidu-map  :scroll-wheel-zoom=\"true\" class=\"map\" :center=\"center\" :zoom=\"zoom\" @ready=\"handler\" map-type=\"BMAP_HYBRID_MAP\"\r\n            @click=\"paintPolygon\" @mousemove=\"syncPolygon\" @rightclick=\"newPolygon\"\r\n        >\r\n\r\n            <bm-scale anchor=\"BMAP_ANCHOR_TOP_RIGHT\"></bm-scale>\r\n            <bm-navigation anchor=\"BMAP_ANCHOR_TOP_RIGHT\"></bm-navigation>\r\n\r\n            <!-- <bm-marker \r\n                v-for=\"(item) in Polygons\"\r\n                :key=\"item.lat\"\r\n                :position=\"item.position\" \r\n                @click=\"infoWindowOpen(item)\"\r\n            >\r\n            </bm-marker>\r\n\r\n            <bm-info-window \r\n                \r\n                :position=\"infoPosition\"\r\n                :show=\"show\" \r\n                @close=\"infoWindowClose\"\r\n                :offset=\"infosize\"\r\n            >\r\n                <div>当前池塘详细信息：</div>\r\n                <div>池塘负责人：{{infoOwner.name}}</div>\r\n                <div>养殖品种：<el-button @click=\"goProduct(infoproduct.id)\" type=\"text\">{{infoproduct.name}}</el-button></div>\r\n                <el-button type=\"text\">查看该池塘详细信息</el-button>\r\n            </bm-info-window>\r\n\r\n\r\n\r\n            <bm-polygon \r\n                \r\n                v-for=\"(item,index) in Polygons\" \r\n                :key=\"index\" \r\n                :path=\"item.polygon\"\r\n                :editing=\"item.editing\"\r\n                @lineupdate='polygonsUpdate'\r\n            ></bm-polygon> -->\r\n            \r\n            <!-- <bm-polygon \r\n                :editing='drawingEditing' \r\n                :path=\"path\" \r\n                v-for=\"path,index of drawingPolygon.paths\" \r\n                :key='index+65535'\r\n                @lineupdate=\"polygonUpdate\"\r\n            ></bm-polygon>\r\n            <bm-marker v-if=\"drawingMarker\" :position='drawingMarker' ></bm-marker> -->\r\n\r\n        </baidu-map>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name:'addMap',\r\n    data(){\r\n        return{\r\n            //地图初始配置\r\n            center: {lng: 0, lat: 0},\r\n            zoom: 3,\r\n            marker:{},\r\n            position:{lng: 0, lat: 0},\r\n            draggable:false,\r\n            //infowindow展示\r\n            show:false,\r\n        }\r\n    },\r\n    methods:{\r\n        // 初始化地图参数\r\n        handler ({BMap, map}) {\r\n            // console.log(BMap, map)\r\n            this.center.lng = 122.048\r\n            this.center.lat = 29.9424\r\n            this.zoom = 16\r\n\r\n            this.position.lng = 122.048\r\n            this.position.lat = 29.9424\r\n\r\n            this.draggable=true\r\n\r\n        },\r\n        //获取池塘\r\n        getPonds(){\r\n            this.$axios({\r\n                url:'/api/ponds/getAll',\r\n                methods:'GET'\r\n            }).then(res=>{\r\n                console.log(res.data.data);\r\n                if(res.data.status==200){\r\n                    this.$store.commit('ponds/setPolygons',res.data.data.data)\r\n                }\r\n            })\r\n        },\r\n        //跳转到水产\r\n        goProduct(id){\r\n            this.$router.push({\r\n                path:`/products/add?id=${id}`\r\n            })\r\n        },\r\n\r\n                paintPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n\r\n            !paths.length && paths.push([])\r\n\r\n            paths[paths.length - 1].push(e.point)\r\n\r\n\r\n        },\r\n        syncPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            if (!paths.length) {\r\n                return\r\n            }\r\n            const path = paths[paths.length - 1]\r\n            if (!path.length) {\r\n                return\r\n            }\r\n            if (path.length === 1) {\r\n                path.push(e.point)\r\n            }\r\n            this.$set(path, path.length - 1, e.point)\r\n        },\r\n        newPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            if(!paths.length) {\r\n                paths.push([])\r\n            }\r\n            const path = paths[paths.length - 1]\r\n            path.pop()\r\n            if (path.length) {\r\n                paths.push([])\r\n            }\r\n            this.getCenterPoint()\r\n            this.getArea()\r\n        },\r\n    },\r\n    computed:{\r\n        Polygons(){\r\n            return this.$store.state.ponds.polygons\r\n        },\r\n        AddPond(){\r\n            return this.$store.state.ponds.addPond\r\n        },\r\n        EditPond(){\r\n            return this.$store.state.ponds.editPond\r\n        },\r\n    },\r\n    created(){\r\n        this.getPonds()\r\n    },\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}