{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: \"addMap\",\n  data() {\n    return {\n      //地图初始配置\n      center: {\n        lng: 0,\n        lat: 0\n      },\n      zoom: 3,\n      marker: {},\n      position: {\n        lng: 0,\n        lat: 0\n      },\n      draggable: false,\n      show: false,\n      //需要绘制的图行\n      drawingPolygon: {\n        editing: false,\n        paths: []\n      },\n      drawingMarker: {},\n      drawingEditing: false,\n      poly: [\n        // {\n        //     lng:29.9424,\n        //     lat:122.048,\n        //     polygon:[\n        //         {lng: '122.0452438546', lat: '29.94264534284173'},\n        //         {lng: '122.0457689541', lat: '29.942290903455056'},\n        //         {lng: '122.0448565938', lat: '29.940878850006936'},\n        //         {lng: '122.0442264745', lat: '29.94178210920206'},\n        //     ],\n        // }\n      ]\n    };\n  },\n  methods: {\n    toggle(name) {\n      this[name].editing = !this[name].editing;\n    },\n    fn(e) {\n      console.log(e);\n    },\n    drawEdit() {\n      this.drawingEditing = true;\n    },\n    polygonUpdate(e) {\n      this.drawingPolygon.paths[0] = e.target.getPath();\n    },\n    paintPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      !paths.length && paths.push([]);\n      paths[paths.length - 1].push(e.point);\n    },\n    syncPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      if (!paths.length) {\n        return;\n      }\n      const path = paths[paths.length - 1];\n      if (!path.length) {\n        return;\n      }\n      if (path.length === 1) {\n        path.push(e.point);\n      }\n      this.$set(path, path.length - 1, e.point);\n    },\n    newPolygon(e) {\n      if (!this.drawingPolygon.editing) {\n        return;\n      }\n      const {\n        paths\n      } = this.drawingPolygon;\n      if (!paths.length) {\n        paths.push([]);\n      }\n      const path = paths[paths.length - 1];\n      path.pop();\n      if (path.length) {\n        paths.push([]);\n      }\n      //此后为编辑模式\n      this.$store.commit('ponds/setDrawing', 2);\n      this.getCenterPoint();\n    },\n    handler({\n      BMap,\n      map\n    }) {\n      // console.log(BMap, map)\n      this.center.lng = 122.048;\n      this.center.lat = 29.9424;\n      this.zoom = 16;\n      this.position.lng = 122.048;\n      this.position.lat = 29.9424;\n      this.draggable = true;\n      this.poly = this.$store.state.ponds.polygons;\n    },\n    infoWindowClose() {\n      this.show = false;\n    },\n    infoWindowOpen() {\n      this.show = true;\n    },\n    //获取池塘\n    getPonds() {\n      this.$axios({\n        url: '/api/ponds/getAll',\n        methods: 'GET'\n      }).then(res => {\n        console.log(res.data.data);\n        if (res.data.status == 200) {\n          this.$store.commit('ponds/setPolygons', res.data.data.data);\n        }\n      });\n    },\n    goProduct(id) {\n      // console.log(id);\n      this.$router.push({\n        path: `/products/add?id=${id}`\n      });\n    },\n    //计算中心点\n    getCenterPoint() {\n      const {\n        paths\n      } = this.drawingPolygon;\n      //添加marker\n      //计算中心点\n      let lng = 0;\n      let lat = 0;\n      paths[0].forEach((i, v) => {\n        lng = lng + i.lng;\n        lat = lat + i.lat;\n      });\n      lng = lng / paths[0].length;\n      lat = lat / paths[0].length;\n      let drawingObj = {\n        lng: lng,\n        lat: lat\n      };\n      this.drawingMarker = drawingObj;\n      this.$store.commit('ponds/setMarker', this.drawingMarker);\n    }\n    //计算面积\n  },\n\n  created() {\n    this.getPonds();\n  },\n  mounted() {},\n  computed: {\n    Drawing() {\n      return this.$store.state.ponds.drawing;\n    }\n  },\n  watch: {\n    Drawing(n, o) {\n      if (n == 0) {\n        this.drawingPolygon.editing = false;\n      } else if (n == 1) {\n        this.drawingPolygon.editing = true;\n      } else if (n == 2) {\n        this.drawingEditing = false;\n        this.drawingPolygon.editing = false;\n        //计算中心点\n        this.getCenterPoint();\n      } else if (n == 3) {\n        this.drawingEditing = true;\n        this.drawingPolygon.editing = false;\n      }\n    }\n  }\n};","map":{"version":3,"mappings":";AAkDA;EACAA;EACAC;IACA;MACA;MACAC;QAAAC;QAAAC;MAAA;MACAC;MACAC;MACAC;QAAAJ;QAAAC;MAAA;MACAI;MACAC;MACA;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MAEAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MAAA;IAKA;EACA;EACAC;IACAC;MACA;IACA;IAEAC;MACAC;IACA;IAEAC;MACA;IACA;IACAC;MAEA;IAEA;IAGAC;MACA;QACA;MACA;MACA;QAAAV;MAAA;MAEA;MAEAA;IAGA;IACAW;MACA;QACA;MACA;MACA;QAAAX;MAAA;MACA;QACA;MACA;MACA;MACA;QACA;MACA;MACA;QACAY;MACA;MACA;IACA;IACAC;MACA;QACA;MACA;MACA;QAAAb;MAAA;MACA;QACAA;MACA;MACA;MACAY;MACA;QACAZ;MACA;MACA;MACA;MAEA;IAGA;IACAc;MAAAC;MAAAC;IAAA;MACA;MACA;MACA;MACA;MAEA;MACA;MAEA;MAGA;IAIA;IACAC;MACA;IACA;IACAC;MACA;IACA;IAGA;IACAC;MACA;QACAC;QACAhB;MACA;QACAG;QACA;UACA;QAEA;MACA;IACA;IACAc;MAEA;MACA;QACAT;MACA;IACA;IAEA;IACAU;MACA;QAAAtB;MAAA;MACA;MACA;MACA;MACA;MAEAA;QACAT;QACAC;MACA;MAEAD;MACAC;MACA;QACAD;QACAC;MACA;MACA;MACA;IACA;IACA;EACA;;EACA+B;IACA;EACA;EACAC,WAEA;EACAC;IAEAC;MACA;IACA;EAEA;EACAC;IACAD;MACA;QACA;MAEA;QACA;MAEA;QACA;QACA;QACA;QACA;MAEA;QACA;QACA;MAEA;IACA;EACA;AACA","names":["name","data","center","lng","lat","zoom","marker","position","draggable","show","drawingPolygon","editing","paths","drawingMarker","drawingEditing","poly","methods","toggle","fn","console","drawEdit","polygonUpdate","paintPolygon","syncPolygon","path","newPolygon","handler","BMap","map","infoWindowClose","infoWindowOpen","getPonds","url","goProduct","getCenterPoint","created","mounted","computed","Drawing","watch"],"sourceRoot":"src/components/ponds/AddPonds","sources":["AddMap.vue"],"sourcesContent":["<template>\r\n    <div class=\"addMap\">\r\n        <baidu-map  class=\"map\" :center=\"center\" :zoom=\"zoom\" @ready=\"handler\" map-type=\"BMAP_HYBRID_MAP\"\r\n            @click=\"paintPolygon\" @mousemove=\"syncPolygon\" @rightclick=\"newPolygon\"\r\n        >\r\n\r\n            <bm-scale anchor=\"BMAP_ANCHOR_TOP_RIGHT\"></bm-scale>\r\n            <bm-navigation anchor=\"BMAP_ANCHOR_TOP_RIGHT\"></bm-navigation>\r\n\r\n            <bm-marker \r\n                v-for=\"(item) in poly\"\r\n                :key=\"item.lat\"\r\n                :position=\"item.position\" \r\n                @click=\"infoWindowOpen\"\r\n            >\r\n                <bm-info-window \r\n                    :show=\"show\" \r\n                    @close=\"infoWindowClose\" \r\n                    \r\n                >\r\n                    <div>当前池塘详细信息：</div>\r\n                    <div>池塘负责人：{{item.owner.name}}</div>\r\n                    <div>养殖品种：<el-button @click=\"goProduct(item.product.id)\" type=\"text\">{{item.product.name}}</el-button></div>\r\n                    <el-button type=\"text\">查看该池塘详细信息</el-button>\r\n\r\n                    \r\n                </bm-info-window>\r\n            </bm-marker>\r\n\r\n            <bm-polygon \r\n                \r\n                v-for=\"(item,index) in poly\" \r\n                :key=\"index\" \r\n                :path=\"item.polygon\"\r\n                @click=\"fn\"\r\n            ></bm-polygon>\r\n            \r\n            <bm-polygon \r\n                :editing='drawingEditing' \r\n                :path=\"path\" \r\n                v-for=\"path,index of drawingPolygon.paths\" \r\n                :key='index+65535'\r\n                @lineupdate=\"polygonUpdate\"\r\n            ></bm-polygon>\r\n            <bm-marker :position='drawingMarker' ></bm-marker>\r\n        </baidu-map>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name:\"addMap\",\r\n    data(){\r\n        return {\r\n            //地图初始配置\r\n            center: {lng: 0, lat: 0},\r\n            zoom: 3,\r\n            marker:{},\r\n            position:{lng: 0, lat: 0},\r\n            draggable:false,\r\n            show:false,\r\n            //需要绘制的图行\r\n            drawingPolygon: {\r\n                editing: false,\r\n                paths: []\r\n            },\r\n            drawingMarker:{},\r\n            drawingEditing:false,\r\n\r\n            poly:[\r\n                // {\r\n                //     lng:29.9424,\r\n                //     lat:122.048,\r\n                //     polygon:[\r\n                //         {lng: '122.0452438546', lat: '29.94264534284173'},\r\n                //         {lng: '122.0457689541', lat: '29.942290903455056'},\r\n                //         {lng: '122.0448565938', lat: '29.940878850006936'},\r\n                //         {lng: '122.0442264745', lat: '29.94178210920206'},\r\n                //     ],\r\n                // }\r\n            ],\r\n\r\n\r\n\r\n        }\r\n    },\r\n    methods:{\r\n        toggle (name) {\r\n            this[name].editing = !this[name].editing\r\n        },\r\n\r\n        fn(e){\r\n            console.log(e);\r\n        },\r\n\r\n        drawEdit(){\r\n            this.drawingEditing=true\r\n        },\r\n        polygonUpdate(e){\r\n            \r\n            this.drawingPolygon.paths[0]=e.target.getPath()\r\n            \r\n        },\r\n\r\n\r\n        paintPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n\r\n            !paths.length && paths.push([])\r\n\r\n            paths[paths.length - 1].push(e.point)\r\n\r\n\r\n        },\r\n        syncPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            if (!paths.length) {\r\n                return\r\n            }\r\n            const path = paths[paths.length - 1]\r\n            if (!path.length) {\r\n                return\r\n            }\r\n            if (path.length === 1) {\r\n                path.push(e.point)\r\n            }\r\n            this.$set(path, path.length - 1, e.point)\r\n        },\r\n        newPolygon (e) {\r\n            if (!this.drawingPolygon.editing) {\r\n                return\r\n            }\r\n            const {paths} = this.drawingPolygon\r\n            if(!paths.length) {\r\n                paths.push([])\r\n            }\r\n            const path = paths[paths.length - 1]\r\n            path.pop()\r\n            if (path.length) {\r\n                paths.push([])\r\n            }\r\n            //此后为编辑模式\r\n            this.$store.commit('ponds/setDrawing',2)\r\n            \r\n            this.getCenterPoint()\r\n            \r\n\r\n        },\r\n        handler ({BMap, map}) {\r\n            // console.log(BMap, map)\r\n            this.center.lng = 122.048\r\n            this.center.lat = 29.9424\r\n            this.zoom = 16\r\n\r\n            this.position.lng = 122.048\r\n            this.position.lat = 29.9424\r\n\r\n            this.draggable=true\r\n\r\n            \r\n            this.poly=this.$store.state.ponds.polygons\r\n\r\n\r\n\r\n        },\r\n        infoWindowClose () {\r\n            this.show = false\r\n        },\r\n        infoWindowOpen () {\r\n            this.show = true\r\n        },\r\n\r\n\r\n        //获取池塘\r\n        getPonds(){\r\n            this.$axios({\r\n                url:'/api/ponds/getAll',\r\n                methods:'GET'\r\n            }).then(res=>{\r\n                console.log(res.data.data);\r\n                if(res.data.status==200){\r\n                    this.$store.commit('ponds/setPolygons',res.data.data.data)\r\n\r\n                }\r\n            })\r\n        },\r\n        goProduct(id){\r\n\r\n            // console.log(id);\r\n            this.$router.push({\r\n                path:`/products/add?id=${id}`\r\n            })\r\n        },\r\n\r\n        //计算中心点\r\n        getCenterPoint(){\r\n            const {paths} = this.drawingPolygon\r\n            //添加marker\r\n            //计算中心点\r\n            let lng=0\r\n            let lat=0\r\n\r\n            paths[0].forEach((i,v)=>{\r\n                lng=lng+i.lng\r\n                lat=lat+i.lat\r\n            })\r\n            \r\n            lng=lng/paths[0].length\r\n            lat=lat/paths[0].length\r\n            let drawingObj={\r\n                lng:lng,\r\n                lat:lat\r\n            }\r\n            this.drawingMarker=drawingObj\r\n            this.$store.commit('ponds/setMarker',this.drawingMarker)\r\n        },\r\n        //计算面积\r\n    },\r\n    created(){\r\n        this.getPonds()\r\n    },\r\n    mounted(){\r\n\r\n    },\r\n    computed:{\r\n        \r\n        Drawing(){\r\n            return this.$store.state.ponds.drawing\r\n        }\r\n\r\n    },\r\n    watch:{\r\n        Drawing(n,o){\r\n            if(n==0){\r\n                this.drawingPolygon.editing=false\r\n\r\n            }else if(n==1){\r\n                this.drawingPolygon.editing=true\r\n\r\n            }else if(n==2){\r\n                this.drawingEditing=false\r\n                this.drawingPolygon.editing=false\r\n                //计算中心点\r\n                this.getCenterPoint()\r\n\r\n            }else if(n==3){\r\n                this.drawingEditing=true\r\n                this.drawingPolygon.editing=false\r\n\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n    .addMap{\r\n        width: 100%;\r\n        height: 100%;\r\n        .map{\r\n            width: 100%;\r\n            height: 100%;\r\n        }\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}